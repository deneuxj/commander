(function(){var $$=this,$=this.IntelliFactory.Runtime,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;$.Define($$,{Commander:{WebCommander:{FireControl:$.Class({},{Show:function(w){return w.$==1?"return fire only":w.$==2?"hold fire":"free fire";}}),Order:$.Class({},{Show:function(x){var y,z;if(x.$==1){y="Continue";}else{if(x.$==2){y="Form off-road column";}else{if(x.$==3){y="Form on-road column";}else{if(x.$==4){y="Attack formation";}else{if(x.$==5){y="Fire a green flare";}else{if(x.$==6){y="Fire a red flare";}else{if(x.$==7){z=x.$0;y=z;}else{y="Stop";}}}}}}}return y;}}),OrderAndPolicy:$.Class({ToServerInput:function(A,B){var C,D,E,F,G,H,I,J,K,L;if(this.$0.$==1){C="Order_"+a.toSafe(A)+"_Continue";}else{if(this.$0.$==2){C="Order_"+a.toSafe(A)+"_Column";}else{if(this.$0.$==3){C="Order_"+a.toSafe(A)+"_OnRoad";}else{if(this.$0.$==4){C="Order_"+a.toSafe(A)+"_Attack";}else{if(this.$0.$==5){C="Order_"+a.toSafe(A)+"_GreenFlare";}else{if(this.$0.$==6){C="Order_"+a.toSafe(A)+"_RedFlare";}else{if(this.$0.$==7){if(this.$1.$==0){E=this.$0.$0;D=$.New(d,{$:0,$0:$.New(e,{$:7,$0:E}),$1:{$:1,$0:{Speed:$.New(f,{$:1}),FireControl:$.New(g,{$:1})}}}).ToServerInput(A,B);}else{F=this.$0.$0;G=this.$1.$0;H=G.FireControl;I=H.$==1?"R":H.$==2?"H":"F";J=G.Speed;K=J.$==1?"N":J.$==2?"F":"S";L=B(F);D=a.toSafe(I)+a.toSafe(K)+"_"+a.toSafe(A)+"_"+a.toSafe(L);}C=D;}else{C="Order_"+a.toSafe(A)+"_Stop";}}}}}}}return C;}}),ShowPlayers:function(M){var N;N=h.toList(h.delay(function(){var P,Q,R;Q=i.ofArray([l.TextNode("Name")]);R=i.ofArray([l.TextNode("Ping")]);P=i.ofArray([l.Element("td",[],Q),l.Element("td",[],R)]);return h.append([l.Element("tr",[],P)],h.delay(function(){return h.map(function(T){var U,V,W;V=i.ofArray([l.TextNode(a.toSafe(T.Name))]);W=i.ofArray([l.TextNode(m.PadLeft($$.String(T.Ping),3))]);U=i.ofArray([l.Element("td",[],V),l.Element("td",[],W)]);return l.Element("tr",[],U);},M);}));}));return l.Element("table",[],N);},ShowResult:function(X){var Y,_2,_3;Y=function(Z){var _0,_1;_0=Z[0];_1=Z[1];return"Key: "+a.toSafe(_0)+" Value: "+a.toSafe(_1);};_2=i.map(Y,X);_3=i.map(function(_4){return l.TextNode(_4);},_2);return l.Element("div",[],_3);},Speed:$.Class({},{Show:function(_5){return _5.$==1?"normal speed":_5.$==2?"maximum speed":"slow speed";}}),TakeOrders:function(_6,_7){var _8,_9,_,cE,cF;_8={User:{$:0},Platoons:$.New(n,{$:0}),LoginMessage:{$:0}};_9=o.Create(_8);_=function(ba){var bb,bc,bd,be,bf,bg,bh,bi,bj,bt,bv,bw,bx,by,bz,bA,bB,bC,bF,bG,bH,bI,bJ,bL,bP,bS,bT,bY,bZ,b0,b2,b4,b6,b7,b8,b9,b_,b$,ct,cw,cx,cy,cz,cA,cD;bb=ba.User;if(bb.$==1){be=bb.$0;bf="Command panel for "+a.toSafe(be);bd=l.TextNode(bf);}else{bg=o.Create("AAA1234");bj=$.New(n,{$:0});bt=function(){return r.Send("Commander:3",[]);};bi=i.ofArray([l.TextNode("Your PIN: "),l.Input($.New(n,{$:0}),bg),l.Button("Log in",bj,function(){var bl;bl=p.Delay(function(){var bn;bn=r.Async("Commander:2",[s.Get(bg)]);return p.Bind(bn,function(bo){var bp,bq,br,bs;if(bo.$==0){bq={$:1,$0:"Incorrect pin code"};}else{br=bo.$0;bq={$:1,$0:"Welcome "+a.toSafe(br)};}bp=bq;bs={User:bo,Platoons:ba.Platoons,LoginMessage:bp};s.Set(_9,bs);return p.Return(null);});});return p.Start(bl,{$:0});}),l.Button("Request PIN",$.New(n,{$:0}),bt)]);bv=ba.LoginMessage;if(bv.$==1){bx=bv.$0;bw=bx;}else{bw="";}bh=i.ofArray([l.Element("div",[],bi),l.TextNode(bw)]);bd=l.Element("div",[],bh);}bc=bd;by=ba.User;if(by.$==1){bB=by.$0;bC=function(bD){var bE;bE=i.contains(bD,ba.Platoons);return!bE;};bF=i.filter(bC,_7);if(bF.$==1){bH=bF.$0;bI=o.Create(bH);bL=function(bM){var bN,bO;bN=$.New(n,{$:1,$0:bM,$1:ba.Platoons});bO={User:ba.User,Platoons:bN,LoginMessage:ba.LoginMessage};return s.Set(_9,bO);};bJ=i.ofArray([l.Select($.New(n,{$:0}),function(bK){return bK;},bF,bI),l.ButtonView("Add",$.New(n,{$:0}),bI.get_View(),bL)]);bG=l.Element("div",[],bJ);}else{bG=l.TextNode("All platoons assigned");}bA=bG;}else{bA=l.get_Empty();}bz=bA;bP=function(bQ){return function(bR){return[bR,bQ];};};bS=i.mapi(bP,_6);bT=function(bU){return function(bV){var bW,bX;bW=bV[0];bX=bV[1];return bU.Add(bW,bX);};};bY=u.New1([]);bZ=h.fold(bT,bY,bS);b0=function(b1){return"WP"+$$.String(bZ.get_Item(b1));};b2=function(b3){return b3==="North"?[0,{$:0}]:b3==="North-East"?[1,{$:0}]:b3==="East"?[2,{$:0}]:b3==="South-East"?[3,{$:0}]:b3==="South"?[4,{$:0}]:b3==="South-West"?[5,{$:0}]:b3==="West"?[6,{$:0}]:b3==="North-West"?[7,{$:0}]:[8,{$:1,$0:b3}];};b4=function(b5){return $.New(e,{$:7,$0:b5});};b6=i.sortBy(b2,_6);b7=i.map(b4,b6);b8=i.ofArray([$.New(e,{$:3}),$.New(e,{$:2}),$.New(e,{$:4}),$.New(e,{$:5}),$.New(e,{$:6})]);b9=i.ofArray([$.New(f,{$:0}),$.New(f,{$:2})]);b_=i.ofArray([$.New(g,{$:0}),$.New(g,{$:1})]);b$=function(ca){var cb,cc,cd,ce,cf,ch,cm,cp,cr;cb=o.Create(i.head(b8));cc=o.Create(i.head(b7));cd=o.Create(i.head(b9));ce=o.Create(i.head(b_));ch=function(){var cj;cj=$.New(d,{$:0,$0:s.Get(cb),$1:{$:0}});return r.Send("Commander:0",[cj.ToServerInput(ca,b0)]);};cm=function(){var co;co=$.New(d,{$:0,$0:s.Get(cc),$1:{$:1,$0:{Speed:s.Get(cd),FireControl:s.Get(ce)}}});return r.Send("Commander:0",[co.ToServerInput(ca,b0)]);};cp=function(){return r.Send("Commander:0",[$.New(d,{$:0,$0:$.New(e,{$:0}),$1:{$:0}}).ToServerInput(ca,b0)]);};cr=function(){return r.Send("Commander:0",[$.New(d,{$:0,$0:$.New(e,{$:1}),$1:{$:0}}).ToServerInput(ca,b0)]);};cf=i.ofArray([l.TextNode(ca),l.Select($.New(n,{$:0}),function(cg){return e.Show(cg);},b8,cb),l.Button("Order",$.New(n,{$:0}),ch),l.TextNode(" - "),l.TextNode("Move towards..."),l.Select($.New(n,{$:0}),function(cj){return e.Show(cj);},b7,cc),l.TextNode(" at "),l.Select($.New(n,{$:0}),function(ck){return f.Show(ck);},b9,cd),l.TextNode(", "),l.Select($.New(n,{$:0}),function(cl){return g.Show(cl);},b_,ce),l.Button("Move",$.New(n,{$:0}),cm),l.TextNode(" - "),l.Button("Stop",$.New(n,{$:0}),cp),l.TextNode(" "),l.Button("Continue",$.New(n,{$:0}),cr)]);return l.Element("div",[],cf);};ct=h.toList(h.delay(function(){return h.map(function(cv){return b$(cv);},ba.Platoons);}));cw=l.Element("div",[],ct);cx=ba.User;if(cx.$==1){cx.$0;cA=function(){var cC;cC={User:{$:0},Platoons:$.New(n,{$:0}),LoginMessage:ba.LoginMessage};return s.Set(_9,cC);};cz=l.Button("Log out",$.New(n,{$:0}),cA);}else{cz=l.get_Empty();}cy=cz;cD=i.ofArray([bc,bz,cw,cy]);return l.Element("div",[],cD);};cE=_9.get_View();cF=v.Map(_,cE);return l.EmbedView(cF);}}}});$.OnInit(function(){a=$.Safe($$.WebSharper.PrintfHelpers);b=$.Safe($$.Commander);c=$.Safe(b.WebCommander);d=$.Safe(c.OrderAndPolicy);e=$.Safe(c.Order);f=$.Safe(c.Speed);g=$.Safe(c.FireControl);h=$.Safe($$.WebSharper.Seq);i=$.Safe($$.WebSharper.List);j=$.Safe($$.WebSharper.UI);k=$.Safe(j.Next);l=$.Safe(k.Doc);m=$.Safe($$.WebSharper.Strings);n=$.Safe(i.T);o=$.Safe(k.Var);p=$.Safe($$.WebSharper.Concurrency);q=$.Safe($$.WebSharper.Remoting);r=$.Safe(q.AjaxRemotingProvider);s=$.Safe(k.Var1);t=$.Safe($$.WebSharper.Collections);u=$.Safe(t.FSharpMap);return v=$.Safe(k.View);});$.OnLoad(function(){return;});}());
