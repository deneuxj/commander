(function(){var $$=this,$=this.IntelliFactory.Runtime,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;$.Define($$,{Commander:{WebCommander:{FireControl:$.Class({},{Show:function(x){return x.$==1?"return fire only":x.$==2?"hold fire":"free fire";}}),Order:$.Class({},{Show:function(y){var z,A;if(y.$==1){z="Continue";}else{if(y.$==2){z="Form off-road column";}else{if(y.$==3){z="Form on-road column";}else{if(y.$==4){z="Attack formation";}else{if(y.$==5){z="Fire a green flare";}else{if(y.$==6){z="Fire a red flare";}else{if(y.$==7){A=y.$0;z=A;}else{z="Stop";}}}}}}}return z;}}),OrderAndPolicy:$.Class({Description:function(B){var C,D,E,F,G,H,I,J,K;if(this.$0.$==1){C=a.toSafe(B)+": Continue";}else{if(this.$0.$==2){C=a.toSafe(B)+": Column";}else{if(this.$0.$==3){C=a.toSafe(B)+": On road";}else{if(this.$0.$==4){C=a.toSafe(B)+": Attack formation";}else{if(this.$0.$==5){C=a.toSafe(B)+": Fire green flare";}else{if(this.$0.$==6){C=a.toSafe(B)+": Fire red flare";}else{if(this.$0.$==7){if(this.$1.$==0){E=this.$0.$0;D=$.New(d,{$:0,$0:$.New(e,{$:7,$0:E}),$1:{$:1,$0:{Speed:$.New(f,{$:1}),FireControl:$.New(g,{$:1})}}}).Description(B);}else{F=this.$0.$0;G=this.$1.$0;H=G.FireControl;I=H.$==1?"return fire":H.$==2?"hold fire":"free fire";J=G.Speed;K=J.$==1?"normal":J.$==2?"fast":"slow";D=a.toSafe(B)+": Move to "+a.toSafe(F)+" at "+a.toSafe(K)+" speed, "+a.toSafe(I);}C=D;}else{C=a.toSafe(B)+": Stop";}}}}}}}return C;},ToServerInput:function(L,M){var N,O,P,Q,R,S,T,U,V,W;if(this.$0.$==1){N="Order_"+a.toSafe(L)+"_Continue";}else{if(this.$0.$==2){N="Order_"+a.toSafe(L)+"_Column";}else{if(this.$0.$==3){N="Order_"+a.toSafe(L)+"_OnRoad";}else{if(this.$0.$==4){N="Order_"+a.toSafe(L)+"_Attack";}else{if(this.$0.$==5){N="Order_"+a.toSafe(L)+"_GreenFlare";}else{if(this.$0.$==6){N="Order_"+a.toSafe(L)+"_RedFlare";}else{if(this.$0.$==7){if(this.$1.$==0){P=this.$0.$0;O=$.New(d,{$:0,$0:$.New(e,{$:7,$0:P}),$1:{$:1,$0:{Speed:$.New(f,{$:1}),FireControl:$.New(g,{$:1})}}}).ToServerInput(L,M);}else{Q=this.$0.$0;R=this.$1.$0;S=R.FireControl;T=S.$==1?"R":S.$==2?"H":"F";U=R.Speed;V=U.$==1?"N":U.$==2?"F":"S";W=M(Q);O=a.toSafe(T)+a.toSafe(V)+"_"+a.toSafe(L)+"_"+a.toSafe(W);}N=O;}else{N="Order_"+a.toSafe(L)+"_Stop";}}}}}}}return N;}}),ShowPlayers:function(X){var Y;Y=h.toList(h.delay(function(){var _0,_1,_2;_1=i.ofArray([l.TextNode("Name")]);_2=i.ofArray([l.TextNode("Ping")]);_0=i.ofArray([l.Element("td",[],_1),l.Element("td",[],_2)]);return h.append([l.Element("tr",[],_0)],h.delay(function(){return h.map(function(_4){var _5,_6,_7;_6=i.ofArray([l.TextNode(a.toSafe(_4.Name))]);_7=i.ofArray([l.TextNode(m.PadLeft($$.String(_4.Ping),3))]);_5=i.ofArray([l.Element("td",[],_6),l.Element("td",[],_7)]);return l.Element("tr",[],_5);},X);}));}));return l.Element("table",[],Y);},ShowResult:function(_8){var _9,bc,bd;_9=function(_){var ba,bb;ba=_[0];bb=_[1];return"Key: "+a.toSafe(ba)+" Value: "+a.toSafe(bb);};bc=i.map(_9,_8);bd=i.map(function(be){return l.TextNode(be);},bc);return l.Element("div",[],bd);},Speed:$.Class({},{Show:function(be){return be.$==1?"normal speed":be.$==2?"maximum speed":"slow speed";}}),TakeOrders:function(bf,bg,bh){var bi,bj,bk,bl,bm,bU,ck,dx,dy,dz,dA,dB,dC,dD,dE;bi={User:{$:0},Coalition:{$:0},Platoons:$.New(n,{$:0})};bj=o.Create(bi);bk=o.Create($.New(n,{$:0}));bl=o.Create("Welcome to Coconut's 'Ground Commander' for IL-2 Sturmovik: Battle Of Stalingrad");bm=function(bn){var bo,bp,bq,br,bv,bw,bx,by,bz,bA,bC,bD;bo=bn.User;if(bo.$==1){bq=bo.$0;br=function(){var bt,bu;q.Send("Commander:10",[bq]);bt={$:0};bu=$.New(n,{$:0});r.Set(bj,{User:bt,Coalition:{$:0},Platoons:bu});return r.Set(bl,"");};bp=l.Button("Log out",$.New(n,{$:0}),br);}else{bv=o.Create("AAA");bw=o.Create("1234");bx=o.Create("playerName");bA=function(bB){return q.Send("Commander:2",[bB]);};bz=i.ofArray([l.TextNode("Request PIN "),l.Input($.New(n,{$:0}),bx),l.ButtonView("Send PIN to my in-game chat",$.New(n,{$:0}),bx.get_View(),bA)]);bD=$.New(n,{$:0});bC=i.ofArray([l.TextNode("Your coalition code (3 letters) and your PIN (4 digits):"),l.Input($.New(n,{$:0}),bv),l.Input($.New(n,{$:0}),bw),l.TextNode(" "),l.Button("Log in",bD,function(){var bF;bF=s.Delay(function(){var bH;bH=q.Async("Commander:3",[r.Get(bw),r.Get(bv).toUpperCase()]);return s.Bind(bH,function(bI){var bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS;if(bI.$==0){bK=[{$:0},{$:0},"Incorrect coalition code or PIN"];}else{bL=bI.$0[0].$0;bM=bI.$0[0];bN=bI.$0[1];bO=bN.AsString();bK=[{$:1,$0:bM},{$:1,$0:bN},"Welcome "+a.toSafe(bL)+" in coalition "+a.toSafe(bO)];}bJ=bK;bP=bJ[0];bQ=bJ[2];bR=bJ[1];bS=bR.$==0?$.New(n,{$:0}):bR.$0.$==0?bg:bh;return s.Bind(q.Async("Commander:5",[bS]),function(bT){r.Set(bj,{User:bP,Coalition:bR,Platoons:bn.Platoons});r.Set(bk,bT);r.Set(bl,bQ);return s.Return(null);});});});return s.Start(bF,{$:0});})]);by=i.ofArray([l.Element("div",[],bz),l.Element("div",[],bC)]);bp=l.Element("div",[],by);}return bp;};bU=function(bV){return function(bW){var bX,bY,bZ,b0,b1,b2,b3,b4,b5,ca,cb,cj;bX=[bV.User,bV.Coalition];if(bX[1].$==1){if(bX[0].$==1){b0=bX[1].$0;b1=bX[0].$0;if(bW.$==1){b3=bW.$0;b4=o.Create(b3);ca=$.New(n,{$:0});cb=b4.get_View();b5=i.ofArray([l.Button("Update",$.New(n,{$:0}),function(){var b7;b7=s.Delay(function(){var b9;b9=b0.$==0?bg:bh;return s.Bind(q.Async("Commander:5",[b9]),function(b_){r.Set(bk,b_);return s.Return(null);});});return s.Start(b7,{$:0});}),l.TextNode(" "),l.Select($.New(n,{$:0}),function(b$){return b$.AsString();},bW,b4),l.TextNode(" "),l.ButtonView("Add",ca,cb,function(cc){var cd;cd=s.Delay(function(){var cf;cf=q.Async("Commander:6",[b1,cc]);return s.Bind(cf,function(cg){var ch,ci;if(cg){ci=$.New(n,{$:1,$0:cc,$1:bV.Platoons});r.Set(bj,{User:bV.User,Coalition:bV.Coalition,Platoons:ci});r.Set(bl,"Platoon grabbed: "+a.toSafe(cc.AsString()));ch=s.Return(null);}else{r.Set(bl,"Could not grab control of "+a.toSafe(cc.AsString()));ch=s.Return(null);}return ch;});});return s.Start(cd,{$:0});})]);b2=l.Element("div",[],b5);}else{cj=i.ofArray([l.TextNode("All platoons assigned")]);b2=l.Element("div",[],cj);}bZ=b2;}else{bZ=l.get_Empty();}bY=bZ;}else{bY=l.get_Empty();}return bY;};};ck=function(cl){var cm,cp,cq,cv,cw,cx,cz,cB,cD,cE,cF,cG,cH,cI,cJ,cK,cL,cU,du;cm=function(cn){return function(co){return[co,cn];};};cp=i.mapi(cm,bf);cq=function(cr){return function(cs){var ct,cu;ct=cs[0];cu=cs[1];return cr.Add(ct,cu);};};cv=u.New1([]);cw=h.fold(cq,cv,cp);cx=function(cy){return"WP"+$$.String(cw.get_Item(cy));};cz=function(cA){return cA==="North"?[0,{$:0}]:cA==="North-East"?[1,{$:0}]:cA==="East"?[2,{$:0}]:cA==="South-East"?[3,{$:0}]:cA==="South"?[4,{$:0}]:cA==="South-West"?[5,{$:0}]:cA==="West"?[6,{$:0}]:cA==="North-West"?[7,{$:0}]:[8,{$:1,$0:cA}];};cB=function(cC){return $.New(e,{$:7,$0:cC});};cD=i.sortBy(cz,bf);cE=i.map(cB,cD);cF=i.ofArray([$.New(e,{$:3}),$.New(e,{$:2}),$.New(e,{$:4})]);cG=i.ofArray([$.New(f,{$:0}),$.New(f,{$:2})]);cH=i.ofArray([$.New(g,{$:0}),$.New(g,{$:1})]);cI=cl.User;if(cI.$==0){cJ=l.get_Empty();}else{cK=cI.$0;cL=function(cM){return function(cN){return s.Delay(function(){var cP;cP=q.Async("Commander:8",[cK,cM]);return s.Bind(cP,function(cQ){var cR,cS,cT;if(cQ){cS=cN.ToServerInput(cM.AsString(),cx);cT=cN.Description(cM.AsString());q.Send("Commander:0",[cS,cK,cT]);r.Set(bl,cT);cR=s.Return(null);}else{r.Set(bl,"Failed to send order");cR=s.Return(null);}return cR;});});};};cU=function(cV){var cW,cX,cY,cZ,c0,c1,db,di,dm,dq;cW=o.Create(i.head(cF));cX=o.Create(i.head(cE));cY=o.Create(i.head(cG));cZ=o.Create(i.head(cH));c1=$.New(n,{$:0});db=function(){var dd,de;dd=$.New(d,{$:0,$0:r.Get(cW),$1:{$:0}});de=(cL(cV))(dd);return s.Start(de,{$:0});};di=function(){var dk,dl;dk=$.New(d,{$:0,$0:r.Get(cX),$1:{$:1,$0:{Speed:r.Get(cY),FireControl:r.Get(cZ)}}});dl=(cL(cV))(dk);return s.Start(dl,{$:0});};dm=function(){var _do,dp;_do=$.New(d,{$:0,$0:$.New(e,{$:0}),$1:{$:0}});dp=(cL(cV))(_do);return s.Start(dp,{$:0});};dq=function(){var ds,dt;ds=$.New(d,{$:0,$0:$.New(e,{$:1}),$1:{$:0}});dt=(cL(cV))(ds);return s.Start(dt,{$:0});};c0=i.ofArray([l.Button("X",c1,function(){var c3;c3=s.Delay(function(){var c5,c7,c8,c9,c_;q.Send("Commander:7",[cK,cV]);c5=function(c6){return!v.Equals(cV,c6);};c7=cl.Platoons;c8=i.filter(c5,c7);c9=cl.Coalition;c_=c9.$==0?$.New(n,{$:0}):c9.$0.$==0?bg:bh;return s.Bind(q.Async("Commander:5",[c_]),function(c$){r.Set(bj,{User:cl.User,Coalition:cl.Coalition,Platoons:c8});r.Set(bk,c$);return s.Return(null);});});return s.Start(c3,{$:0});}),l.TextNode(" "),l.TextNode(cV.AsString()),l.TextNode(" "),l.Select($.New(n,{$:0}),function(da){return e.Show(da);},cF,cW),l.TextNode(" "),l.Button("Order",$.New(n,{$:0}),db),l.TextNode(" - "),l.TextNode("Move towards..."),l.Select($.New(n,{$:0}),function(df){return e.Show(df);},cE,cX),l.TextNode(" at "),l.Select($.New(n,{$:0}),function(dg){return f.Show(dg);},cG,cY),l.TextNode(", "),l.Select($.New(n,{$:0}),function(dh){return g.Show(dh);},cH,cZ),l.Button("Move",$.New(n,{$:0}),di),l.TextNode(" - "),l.Button("Stop",$.New(n,{$:0}),dm),l.TextNode(" "),l.Button("Continue",$.New(n,{$:0}),dq)]);return l.Element("div",[],c0);};du=h.toList(h.delay(function(){return h.map(function(dw){return cU(dw);},cl.Platoons);}));cJ=l.Element("div",[],du);}return cJ;};dy=bj.get_View();dz=w.Map(bm,dy);dA=bj.get_View();dB=bk.get_View();dC=w.Map2(bU,dA,dB);dD=bj.get_View();dE=w.Map(ck,dD);dx=i.ofArray([l.TextView(bl.get_View()),l.EmbedView(dz),l.EmbedView(dC),l.EmbedView(dE)]);return l.Element("div",[],dx);}}},Users:{Coalition:$.Class({AsString:function(){return this.$==1?"Allies":"Axis";}},{IdOf:function(dF){return dF.$==1?1:2;}}),Unit:$.Class({AsString:function(){var dG;dG=this.$0;return dG;}}),User:$.Class({AsString:function(){var dH;dH=this.$0;return dH;}})}});$.OnInit(function(){a=$.Safe($$.WebSharper.PrintfHelpers);b=$.Safe($$.Commander);c=$.Safe(b.WebCommander);d=$.Safe(c.OrderAndPolicy);e=$.Safe(c.Order);f=$.Safe(c.Speed);g=$.Safe(c.FireControl);h=$.Safe($$.WebSharper.Seq);i=$.Safe($$.WebSharper.List);j=$.Safe($$.WebSharper.UI);k=$.Safe(j.Next);l=$.Safe(k.Doc);m=$.Safe($$.WebSharper.Strings);n=$.Safe(i.T);o=$.Safe(k.Var);p=$.Safe($$.WebSharper.Remoting);q=$.Safe(p.AjaxRemotingProvider);r=$.Safe(k.Var1);s=$.Safe($$.WebSharper.Concurrency);t=$.Safe($$.WebSharper.Collections);u=$.Safe(t.FSharpMap);v=$.Safe($$.WebSharper.Unchecked);return w=$.Safe(k.View);});$.OnLoad(function(){return;});}());
