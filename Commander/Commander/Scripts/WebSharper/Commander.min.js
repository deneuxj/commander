(function(){var $$=this,$=this.IntelliFactory.Runtime,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y;$.Define($$,{Commander:{GameEvents:{State:$.Class({},{get_Default:function(){return $.New(c,{Authenticated:false,Password:""});}}),showEvents:function(z){var A,B,L;A=f.Create(c.get_Default());B=function(C){var D,E,F,G,I;D=[C,z];if(D[0].Authenticated){if(D[1].$==0){return g.get_Empty();}else{E=D[1].$0;F=f.Create(E);I=function(){return j.Start(j.Delay(function(){l.Send("Commander:12",[C.Password,(m.Get(F))[0]]);return j.Return(null);}),{$:0});};G=h.ofArray([g.Select($.New(i,{$:0}),function(H){return H[1];},z,F),g.TextNode(" "),g.Button("Send",$.New(i,{$:0}),I)]);return g.Element("div",[],G);}}else{return g.get_Empty();}};L=h.ofArray([g.EmbedView(n.Map(function(M){var N,O,Q,R,S;if(M.Authenticated){O=function(){return m.Set(A,c.get_Default());};N=h.ofArray([g.Button("Log out",$.New(i,{$:0}),O)]);return g.Element("div",[],N);}else{Q=f.Create(M.Password);S=function(){return j.Start(j.Delay(function(){return j.Bind(l.Async("Commander:11",[m.Get(Q)]),function(V){m.Set(A,$.New(c,{Authenticated:V,Password:m.Get(Q)}));return j.Return(null);});}),{$:0});};R=h.ofArray([g.TextNode("Password: "),g.Input($.New(i,{$:0}),Q),g.TextNode(" "),g.Button("Send",$.New(i,{$:0}),S)]);return g.Element("div",[],R);}},A.get_View())),g.EmbedView(n.Map(B,A.get_View()))]);return g.Element("div",[],L);}},WebCommander:{FireControl:$.Class({},{Show:function(W){return W.$==1?"return fire only":W.$==2?"hold fire":"free fire";}}),Order:$.Class({},{Show:function(X){var Y,Z;if(X.$==1){Y="Continue";}else{if(X.$==2){Y="Form off-road column";}else{if(X.$==3){Y="Form on-road column";}else{if(X.$==4){Y="Attack formation";}else{if(X.$==5){Y="Fire a green flare";}else{if(X.$==6){Y="Fire a red flare";}else{if(X.$==7){Z=X.$0;Y=Z;}else{Y="Stop";}}}}}}}return Y;}}),OrderAndPolicy:$.Class({Description:function(_0){var _1,_2,_3,_4,_5,_6,_7,_8,_9;if(this.$0.$==1){_1=o.toSafe(_0)+": Continue";}else{if(this.$0.$==2){_1=o.toSafe(_0)+": Column";}else{if(this.$0.$==3){_1=o.toSafe(_0)+": On road";}else{if(this.$0.$==4){_1=o.toSafe(_0)+": Attack formation";}else{if(this.$0.$==5){_1=o.toSafe(_0)+": Fire green flare";}else{if(this.$0.$==6){_1=o.toSafe(_0)+": Fire red flare";}else{if(this.$0.$==7){if(this.$1.$==0){_3=this.$0.$0;_2=$.New(q,{$:0,$0:$.New(r,{$:7,$0:_3}),$1:{$:1,$0:{Speed:$.New(s,{$:1}),FireControl:$.New(t,{$:1})}}}).Description(_0);}else{_4=this.$0.$0;_5=this.$1.$0;_6=_5.FireControl;_7=_6.$==1?"return fire":_6.$==2?"hold fire":"free fire";_8=_5.Speed;_9=_8.$==1?"normal":_8.$==2?"fast":"slow";_2=o.toSafe(_0)+": Move to "+o.toSafe(_4)+" at "+o.toSafe(_9)+" speed, "+o.toSafe(_7);}_1=_2;}else{_1=o.toSafe(_0)+": Stop";}}}}}}}return _1;},ToServerInput:function(_,ba){var bb,bc,bd,be,bf,bg,bh,bi,bj,bk;if(this.$0.$==1){bb="Order_"+o.toSafe(_)+"_Continue";}else{if(this.$0.$==2){bb="Order_"+o.toSafe(_)+"_Column";}else{if(this.$0.$==3){bb="Order_"+o.toSafe(_)+"_OnRoad";}else{if(this.$0.$==4){bb="Order_"+o.toSafe(_)+"_Attack";}else{if(this.$0.$==5){bb="Order_"+o.toSafe(_)+"_GreenFlare";}else{if(this.$0.$==6){bb="Order_"+o.toSafe(_)+"_RedFlare";}else{if(this.$0.$==7){if(this.$1.$==0){bd=this.$0.$0;bc=$.New(q,{$:0,$0:$.New(r,{$:7,$0:bd}),$1:{$:1,$0:{Speed:$.New(s,{$:1}),FireControl:$.New(t,{$:1})}}}).ToServerInput(_,ba);}else{be=this.$0.$0;bf=this.$1.$0;bg=bf.FireControl;bh=bg.$==1?"R":bg.$==2?"H":"F";bi=bf.Speed;bj=bi.$==1?"N":bi.$==2?"F":"S";bk=ba(be);bc=o.toSafe(bh)+o.toSafe(bj)+"_"+o.toSafe(_)+"_"+o.toSafe(bk);}bb=bc;}else{bb="Order_"+o.toSafe(_)+"_Stop";}}}}}}}return bb;}}),ShowPlayers:function(bk){var bl;bl=u.toList(u.delay(function(){var bn,bo,bp;bo=h.ofArray([g.TextNode("Name")]);bp=h.ofArray([g.TextNode("Ping")]);bn=h.ofArray([g.Element("td",[],bo),g.Element("td",[],bp)]);return u.append([g.Element("tr",[],bn)],u.delay(function(){return u.map(function(br){var bs,bt,bu,bv,bw;bu=o.toSafe(br.Name);bt=h.ofArray([g.TextNode(bu)]);bw=v.PadLeft($$.String(br.Ping),3);bv=h.ofArray([g.TextNode(bw)]);bs=h.ofArray([g.Element("td",[],bt),g.Element("td",[],bv)]);return g.Element("tr",[],bs);},bk);}));}));return g.Element("table",[],bl);},ShowResult:function(bx){var by,bC,bD;by=function(bz){var bA,bB;bA=bz[0];bB=bz[1];return"Key: "+o.toSafe(bA)+" Value: "+o.toSafe(bB);};bC=h.map(by,bx);bD=h.map(function(bE){return g.TextNode(bE);},bC);return g.Element("div",[],bD);},Speed:$.Class({},{Show:function(bF){return bF.$==1?"normal speed":bF.$==2?"maximum speed":"slow speed";}}),TakeOrders:function(bG,bH,bI){var bJ,bK,bL,bM,bN,cj,cL,dY,dZ,d0,d1,d2,d3,d4,d5;bJ={User:{$:0},Coalition:{$:0},Platoons:$.New(i,{$:0})};bK=f.Create(bJ);bL=f.Create($.New(i,{$:0}));bM=f.Create("Welcome to Coconut's 'Ground Commander' for IL-2 Sturmovik: Battle Of Stalingrad");bN=function(bO){var bP,bQ,bR,bS,bW,bX,bY,bZ,b0,b1,b3,b4;bP=bO.User;if(bP.$==1){bR=bP.$0;bS=function(){var bU,bV;l.Send("Commander:10",[bR]);bU={$:0};bV=$.New(i,{$:0});m.Set(bK,{User:bU,Coalition:{$:0},Platoons:bV});return m.Set(bM,"");};bQ=g.Button("Log out",$.New(i,{$:0}),bS);}else{bW=f.Create("AAA");bX=f.Create("1234");bY=f.Create("playerName");b1=function(b2){return l.Send("Commander:2",[b2]);};b0=h.ofArray([g.TextNode("Request PIN "),g.Input($.New(i,{$:0}),bY),g.ButtonView("Send PIN to my in-game chat",$.New(i,{$:0}),bY.get_View(),b1)]);b4=$.New(i,{$:0});b3=h.ofArray([g.TextNode("Your coalition code (3 letters) and your PIN (4 digits):"),g.Input($.New(i,{$:0}),bW),g.Input($.New(i,{$:0}),bX),g.TextNode(" "),g.Button("Log in",b4,function(){var b6;b6=j.Delay(function(){var b8;b8=l.Async("Commander:3",[m.Get(bX),m.Get(bW).toUpperCase()]);return j.Bind(b8,function(b9){var b_,b$,ca,cb,cc,cd,ce,cf,cg,ch;if(b9.$==0){b$=[{$:0},{$:0},"Incorrect coalition code or PIN"];}else{ca=b9.$0[0].$0;cb=b9.$0[0];cc=b9.$0[1];cd=cc.AsString();b$=[{$:1,$0:cb},{$:1,$0:cc},"Welcome "+o.toSafe(ca)+" in coalition "+o.toSafe(cd)];}b_=b$;ce=b_[0];cf=b_[2];cg=b_[1];ch=cg.$==0?$.New(i,{$:0}):cg.$0.$==0?bH:bI;return j.Bind(l.Async("Commander:5",[ch]),function(ci){m.Set(bK,{User:ce,Coalition:cg,Platoons:bO.Platoons});m.Set(bL,ci);m.Set(bM,cf);return j.Return(null);});});});return j.Start(b6,{$:0});})]);bZ=h.ofArray([g.Element("div",[],b0),g.Element("div",[],b3)]);bQ=g.Element("div",[],bZ);}return bQ;};cj=function(ck){return function(cl){var cm,cn,co,cp,cq,cr,cs,ct,cu,cB,cC,cK;cm=[ck.User,ck.Coalition];if(cm[1].$==1){if(cm[0].$==1){cp=cm[1].$0;cq=cm[0].$0;if(cl.$==1){cs=cl.$0;ct=f.Create(cs);cB=$.New(i,{$:0});cC=ct.get_View();cu=h.ofArray([g.Button("Update",$.New(i,{$:0}),function(){var cw;cw=j.Delay(function(){var cy;cy=cp.$==0?bH:bI;return j.Bind(l.Async("Commander:5",[cy]),function(cz){m.Set(bL,cz);return j.Return(null);});});return j.Start(cw,{$:0});}),g.TextNode(" "),g.Select($.New(i,{$:0}),function(cA){return cA.AsString();},cl,ct),g.TextNode(" "),g.ButtonView("Add",cB,cC,function(cD){var cE;cE=j.Delay(function(){var cG;cG=l.Async("Commander:6",[cq,cD]);return j.Bind(cG,function(cH){var cI,cJ;if(cH){cJ=$.New(i,{$:1,$0:cD,$1:ck.Platoons});m.Set(bK,{User:ck.User,Coalition:ck.Coalition,Platoons:cJ});m.Set(bM,"Platoon grabbed: "+o.toSafe(cD.AsString()));cI=j.Return(null);}else{m.Set(bM,"Could not grab control of "+o.toSafe(cD.AsString()));cI=j.Return(null);}return cI;});});return j.Start(cE,{$:0});})]);cr=g.Element("div",[],cu);}else{cK=h.ofArray([g.TextNode("All platoons assigned")]);cr=g.Element("div",[],cK);}co=cr;}else{co=g.get_Empty();}cn=co;}else{cn=g.get_Empty();}return cn;};};cL=function(cM){var cN,cQ,cR,cW,cX,cY,c0,c2,c4,c5,c6,c7,c8,c9,c_,c$,da,dj,dV;cN=function(cO){return function(cP){return[cP,cO];};};cQ=h.mapi(cN,bG);cR=function(cS){return function(cT){var cU,cV;cU=cT[0];cV=cT[1];return cS.Add(cU,cV);};};cW=x.New1([]);cX=u.fold(cR,cW,cQ);cY=function(cZ){return"WP"+$$.String(cX.get_Item(cZ));};c0=function(c1){return c1==="North"?[0,{$:0}]:c1==="North-East"?[1,{$:0}]:c1==="East"?[2,{$:0}]:c1==="South-East"?[3,{$:0}]:c1==="South"?[4,{$:0}]:c1==="South-West"?[5,{$:0}]:c1==="West"?[6,{$:0}]:c1==="North-West"?[7,{$:0}]:[8,{$:1,$0:c1}];};c2=function(c3){return $.New(r,{$:7,$0:c3});};c4=h.sortBy(c0,bG);c5=h.map(c2,c4);c6=h.ofArray([$.New(r,{$:3}),$.New(r,{$:2}),$.New(r,{$:4})]);c7=h.ofArray([$.New(s,{$:0}),$.New(s,{$:2})]);c8=h.ofArray([$.New(t,{$:0}),$.New(t,{$:1})]);c9=cM.User;if(c9.$==0){c_=g.get_Empty();}else{c$=c9.$0;da=function(db){return function(dc){return j.Delay(function(){var de;de=l.Async("Commander:8",[c$,db]);return j.Bind(de,function(df){var dg,dh,di;if(df){dh=dc.ToServerInput(db.AsString(),cY);di=dc.Description(db.AsString());l.Send("Commander:0",[dh,c$,di]);m.Set(bM,di);dg=j.Return(null);}else{m.Set(bM,"Failed to send order");dg=j.Return(null);}return dg;});});};};dj=function(dk){var dl,dm,dn,_do,dp,dq,dC,dJ,dN,dR;dl=f.Create(h.head(c6));dm=f.Create(h.head(c5));dn=f.Create(h.head(c7));_do=f.Create(h.head(c8));dq=$.New(i,{$:0});dC=function(){var dE,dF;dE=$.New(q,{$:0,$0:m.Get(dl),$1:{$:0}});dF=(da(dk))(dE);return j.Start(dF,{$:0});};dJ=function(){var dL,dM;dL=$.New(q,{$:0,$0:m.Get(dm),$1:{$:1,$0:{Speed:m.Get(dn),FireControl:m.Get(_do)}}});dM=(da(dk))(dL);return j.Start(dM,{$:0});};dN=function(){var dP,dQ;dP=$.New(q,{$:0,$0:$.New(r,{$:0}),$1:{$:0}});dQ=(da(dk))(dP);return j.Start(dQ,{$:0});};dR=function(){var dT,dU;dT=$.New(q,{$:0,$0:$.New(r,{$:1}),$1:{$:0}});dU=(da(dk))(dT);return j.Start(dU,{$:0});};dp=h.ofArray([g.Button("X",dq,function(){var ds;ds=j.Delay(function(){var du,dw,dx,dy,dz;l.Send("Commander:7",[c$,dk]);du=function(dv){return!y.Equals(dk,dv);};dw=cM.Platoons;dx=h.filter(du,dw);dy=cM.Coalition;dz=dy.$==0?$.New(i,{$:0}):dy.$0.$==0?bH:bI;return j.Bind(l.Async("Commander:5",[dz]),function(dA){m.Set(bK,{User:cM.User,Coalition:cM.Coalition,Platoons:dx});m.Set(bL,dA);return j.Return(null);});});return j.Start(ds,{$:0});}),g.TextNode(" "),g.TextNode(dk.AsString()),g.TextNode(" "),g.Select($.New(i,{$:0}),function(dB){return r.Show(dB);},c6,dl),g.TextNode(" "),g.Button("Order",$.New(i,{$:0}),dC),g.TextNode(" - "),g.TextNode("Move towards..."),g.Select($.New(i,{$:0}),function(dG){return r.Show(dG);},c5,dm),g.TextNode(" at "),g.Select($.New(i,{$:0}),function(dH){return s.Show(dH);},c7,dn),g.TextNode(", "),g.Select($.New(i,{$:0}),function(dI){return t.Show(dI);},c8,_do),g.Button("Move",$.New(i,{$:0}),dJ),g.TextNode(" - "),g.Button("Stop",$.New(i,{$:0}),dN),g.TextNode(" "),g.Button("Continue",$.New(i,{$:0}),dR)]);return g.Element("div",[],dp);};dV=u.toList(u.delay(function(){return u.map(function(dX){return dj(dX);},cM.Platoons);}));c_=g.Element("div",[],dV);}return c_;};dZ=bK.get_View();d0=n.Map(bN,dZ);d1=bK.get_View();d2=bL.get_View();d3=n.Map2(cj,d1,d2);d4=bK.get_View();d5=n.Map(cL,d4);dY=h.ofArray([g.TextView(bM.get_View()),g.EmbedView(d0),g.EmbedView(d3),g.EmbedView(d5)]);return g.Element("div",[],dY);}}},Users:{Coalition:$.Class({AsString:function(){return this.$==1?"Allies":"Axis";}},{IdOf:function(d6){return d6.$==1?1:2;}}),Unit:$.Class({AsString:function(){var d7;d7=this.$0;return d7;}}),User:$.Class({AsString:function(){var d8;d8=this.$0;return d8;}})}});$.OnInit(function(){a=$.Safe($$.Commander);b=$.Safe(a.GameEvents);c=$.Safe(b.State);d=$.Safe($$.WebSharper.UI);e=$.Safe(d.Next);f=$.Safe(e.Var);g=$.Safe(e.Doc);h=$.Safe($$.WebSharper.List);i=$.Safe(h.T);j=$.Safe($$.WebSharper.Concurrency);k=$.Safe($$.WebSharper.Remoting);l=$.Safe(k.AjaxRemotingProvider);m=$.Safe(e.Var1);n=$.Safe(e.View);o=$.Safe($$.WebSharper.PrintfHelpers);p=$.Safe(a.WebCommander);q=$.Safe(p.OrderAndPolicy);r=$.Safe(p.Order);s=$.Safe(p.Speed);t=$.Safe(p.FireControl);u=$.Safe($$.WebSharper.Seq);v=$.Safe($$.WebSharper.Strings);w=$.Safe($$.WebSharper.Collections);x=$.Safe(w.FSharpMap);return y=$.Safe($$.WebSharper.Unchecked);});$.OnLoad(function(){return;});}());
