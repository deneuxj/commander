(function(){var $$=this,$=this.IntelliFactory.Runtime,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;$.Define($$,{Commander:{WebCommander:{FireControl:$.Class({},{Show:function(w){return w.$==1?"return fire only":w.$==2?"hold fire":"free fire";}}),Order:$.Class({},{Show:function(x){var y,z;if(x.$==1){y="Continue";}else{if(x.$==2){y="Form off-road column";}else{if(x.$==3){y="Form on-road column";}else{if(x.$==4){y="Attack formation";}else{if(x.$==5){y="Fire a green flare";}else{if(x.$==6){y="Fire a red flare";}else{if(x.$==7){z=x.$0;y=z;}else{y="Stop";}}}}}}}return y;}}),OrderAndPolicy:$.Class({ToServerInput:function(A,B){var C,D,E,F,G,H,I,J,K,L;if(this.$0.$==1){C="Order_"+a.toSafe(A)+"_Continue";}else{if(this.$0.$==2){C="Order_"+a.toSafe(A)+"_Column";}else{if(this.$0.$==3){C="Order_"+a.toSafe(A)+"_OnRoad";}else{if(this.$0.$==4){C="Order_"+a.toSafe(A)+"_Attack";}else{if(this.$0.$==5){C="Order_"+a.toSafe(A)+"_GreenFlare";}else{if(this.$0.$==6){C="Order_"+a.toSafe(A)+"_RedFlare";}else{if(this.$0.$==7){if(this.$1.$==0){E=this.$0.$0;D=$.New(d,{$:0,$0:$.New(e,{$:7,$0:E}),$1:{$:1,$0:{Speed:$.New(f,{$:1}),FireControl:$.New(g,{$:1})}}}).ToServerInput(A,B);}else{F=this.$0.$0;G=this.$1.$0;H=G.FireControl;I=H.$==1?"R":H.$==2?"H":"F";J=G.Speed;K=J.$==1?"N":J.$==2?"F":"S";L=B(F);D=a.toSafe(I)+a.toSafe(K)+"_"+a.toSafe(A)+"_"+a.toSafe(L);}C=D;}else{C="Order_"+a.toSafe(A)+"_Stop";}}}}}}}return C;}}),ShowPlayers:function(M){var N;N=h.toList(h.delay(function(){var P,Q,R;Q=i.ofArray([l.TextNode("Name")]);R=i.ofArray([l.TextNode("Ping")]);P=i.ofArray([l.Element("td",[],Q),l.Element("td",[],R)]);return h.append([l.Element("tr",[],P)],h.delay(function(){return h.map(function(T){var U,V,W;V=i.ofArray([l.TextNode(a.toSafe(T.Name))]);W=i.ofArray([l.TextNode(m.PadLeft($$.String(T.Ping),3))]);U=i.ofArray([l.Element("td",[],V),l.Element("td",[],W)]);return l.Element("tr",[],U);},M);}));}));return l.Element("table",[],N);},ShowResult:function(X){var Y,_2,_3;Y=function(Z){var _0,_1;_0=Z[0];_1=Z[1];return"Key: "+a.toSafe(_0)+" Value: "+a.toSafe(_1);};_2=i.map(Y,X);_3=i.map(function(_4){return l.TextNode(_4);},_2);return l.Element("div",[],_3);},Speed:$.Class({},{Show:function(_5){return _5.$==1?"normal speed":_5.$==2?"maximum speed":"slow speed";}}),TakeOrders:function(_6,_7){var _8,_9,_,cI,cJ;_8={User:{$:0},Platoons:$.New(n,{$:0}),LoginMessage:{$:0}};_9=o.Create(_8);_=function(ba){var bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bx,bz,bA,bB,bC,bD,bE,bF,bG,bJ,bK,bL,bM,bN,bP,bT,bW,bX,b2,b3,b4,b6,b8,b_,b$,ca,cb,cc,cd,cx,cA,cB,cC,cD,cE,cH;bb=ba.User;if(bb.$==1){be=bb.$0;bf="Command panel for "+a.toSafe(be);bd=l.TextNode(bf);}else{bg=o.Create("AAA");bh=o.Create("1234");bk=$.New(n,{$:0});bx=function(){return r.Send("Commander:3",[]);};bj=i.ofArray([l.TextNode("Your coalition code (3 letters) and your pin (4 digits):"),l.Input($.New(n,{$:0}),bg),l.Input($.New(n,{$:0}),bh),l.TextNode(" "),l.Button("Log in",bk,function(){var bm;bm=p.Delay(function(){var bo;bo=r.Async("Commander:2",[s.Get(bh),s.Get(bg).toUpperCase()]);return p.Bind(bo,function(bp){var bq,br,bs,bt,bu,bv,bw;if(bp.$==0){br=[{$:0},{$:1,$0:"Incorrect pin code"}];}else{bs=bp.$0[0];bt=bp.$0[1];br=[{$:1,$0:bs},{$:1,$0:"Welcome "+a.toSafe(bs)+" in coalition "+a.toSafe(bt)}];}bq=br;bu=bq[0];bv=bq[1];bw={User:bu,Platoons:ba.Platoons,LoginMessage:bv};s.Set(_9,bw);return p.Return(null);});});return p.Start(bm,{$:0});}),l.TextNode(" "),l.Button("Request PIN",$.New(n,{$:0}),bx)]);bz=ba.LoginMessage;if(bz.$==1){bB=bz.$0;bA=bB;}else{bA="";}bi=i.ofArray([l.Element("div",[],bj),l.TextNode(bA)]);bd=l.Element("div",[],bi);}bc=bd;bC=ba.User;if(bC.$==1){bF=bC.$0;bG=function(bH){var bI;bI=i.contains(bH,ba.Platoons);return!bI;};bJ=i.filter(bG,_7);if(bJ.$==1){bL=bJ.$0;bM=o.Create(bL);bP=function(bQ){var bR,bS;bR=$.New(n,{$:1,$0:bQ,$1:ba.Platoons});bS={User:ba.User,Platoons:bR,LoginMessage:ba.LoginMessage};return s.Set(_9,bS);};bN=i.ofArray([l.Select($.New(n,{$:0}),function(bO){return bO;},bJ,bM),l.ButtonView("Add",$.New(n,{$:0}),bM.get_View(),bP)]);bK=l.Element("div",[],bN);}else{bK=l.TextNode("All platoons assigned");}bE=bK;}else{bE=l.get_Empty();}bD=bE;bT=function(bU){return function(bV){return[bV,bU];};};bW=i.mapi(bT,_6);bX=function(bY){return function(bZ){var b0,b1;b0=bZ[0];b1=bZ[1];return bY.Add(b0,b1);};};b2=u.New1([]);b3=h.fold(bX,b2,bW);b4=function(b5){return"WP"+$$.String(b3.get_Item(b5));};b6=function(b7){return b7==="North"?[0,{$:0}]:b7==="North-East"?[1,{$:0}]:b7==="East"?[2,{$:0}]:b7==="South-East"?[3,{$:0}]:b7==="South"?[4,{$:0}]:b7==="South-West"?[5,{$:0}]:b7==="West"?[6,{$:0}]:b7==="North-West"?[7,{$:0}]:[8,{$:1,$0:b7}];};b8=function(b9){return $.New(e,{$:7,$0:b9});};b_=i.sortBy(b6,_6);b$=i.map(b8,b_);ca=i.ofArray([$.New(e,{$:3}),$.New(e,{$:2}),$.New(e,{$:4})]);cb=i.ofArray([$.New(f,{$:0}),$.New(f,{$:2})]);cc=i.ofArray([$.New(g,{$:0}),$.New(g,{$:1})]);cd=function(ce){var cf,cg,ch,ci,cj,cl,cq,ct,cv;cf=o.Create(i.head(ca));cg=o.Create(i.head(b$));ch=o.Create(i.head(cb));ci=o.Create(i.head(cc));cl=function(){var cn;cn=$.New(d,{$:0,$0:s.Get(cf),$1:{$:0}});return r.Send("Commander:0",[cn.ToServerInput(ce,b4)]);};cq=function(){var cs;cs=$.New(d,{$:0,$0:s.Get(cg),$1:{$:1,$0:{Speed:s.Get(ch),FireControl:s.Get(ci)}}});return r.Send("Commander:0",[cs.ToServerInput(ce,b4)]);};ct=function(){return r.Send("Commander:0",[$.New(d,{$:0,$0:$.New(e,{$:0}),$1:{$:0}}).ToServerInput(ce,b4)]);};cv=function(){return r.Send("Commander:0",[$.New(d,{$:0,$0:$.New(e,{$:1}),$1:{$:0}}).ToServerInput(ce,b4)]);};cj=i.ofArray([l.TextNode(ce),l.Select($.New(n,{$:0}),function(ck){return e.Show(ck);},ca,cf),l.Button("Order",$.New(n,{$:0}),cl),l.TextNode(" - "),l.TextNode("Move towards..."),l.Select($.New(n,{$:0}),function(cn){return e.Show(cn);},b$,cg),l.TextNode(" at "),l.Select($.New(n,{$:0}),function(co){return f.Show(co);},cb,ch),l.TextNode(", "),l.Select($.New(n,{$:0}),function(cp){return g.Show(cp);},cc,ci),l.Button("Move",$.New(n,{$:0}),cq),l.TextNode(" - "),l.Button("Stop",$.New(n,{$:0}),ct),l.TextNode(" "),l.Button("Continue",$.New(n,{$:0}),cv)]);return l.Element("div",[],cj);};cx=h.toList(h.delay(function(){return h.map(function(cz){return cd(cz);},ba.Platoons);}));cA=l.Element("div",[],cx);cB=ba.User;if(cB.$==1){cB.$0;cE=function(){var cG;cG={User:{$:0},Platoons:$.New(n,{$:0}),LoginMessage:ba.LoginMessage};return s.Set(_9,cG);};cD=l.Button("Log out",$.New(n,{$:0}),cE);}else{cD=l.get_Empty();}cC=cD;cH=i.ofArray([bc,bD,cA,cC]);return l.Element("div",[],cH);};cI=_9.get_View();cJ=v.Map(_,cI);return l.EmbedView(cJ);}}}});$.OnInit(function(){a=$.Safe($$.WebSharper.PrintfHelpers);b=$.Safe($$.Commander);c=$.Safe(b.WebCommander);d=$.Safe(c.OrderAndPolicy);e=$.Safe(c.Order);f=$.Safe(c.Speed);g=$.Safe(c.FireControl);h=$.Safe($$.WebSharper.Seq);i=$.Safe($$.WebSharper.List);j=$.Safe($$.WebSharper.UI);k=$.Safe(j.Next);l=$.Safe(k.Doc);m=$.Safe($$.WebSharper.Strings);n=$.Safe(i.T);o=$.Safe(k.Var);p=$.Safe($$.WebSharper.Concurrency);q=$.Safe($$.WebSharper.Remoting);r=$.Safe(q.AjaxRemotingProvider);s=$.Safe(k.Var1);t=$.Safe($$.WebSharper.Collections);u=$.Safe(t.FSharpMap);return v=$.Safe(k.View);});$.OnLoad(function(){return;});}());
