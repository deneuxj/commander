(function(){var $$=this,$=this.IntelliFactory.Runtime,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;$.Define($$,{Commander:{WebCommander:{FireControl:$.Class({},{Show:function(w){return w.$==1?"return fire only":w.$==2?"hold fire":"free fire";}}),Order:$.Class({},{Show:function(x){var y,z;if(x.$==1){y="Continue";}else{if(x.$==2){y="Form off-road column";}else{if(x.$==3){y="Form on-road column";}else{if(x.$==4){y="Attack formation";}else{if(x.$==5){y="Fire a green flare";}else{if(x.$==6){y="Fire a red flare";}else{if(x.$==7){z=x.$0;y=z;}else{y="Stop";}}}}}}}return y;}}),OrderAndPolicy:$.Class({ToServerInput:function(A,B){var C,D,E,F,G,H,I,J,K,L;if(this.$0.$==1){C="Order_"+a.toSafe(A)+"_Continue";}else{if(this.$0.$==2){C="Order_"+a.toSafe(A)+"_Column";}else{if(this.$0.$==3){C="Order_"+a.toSafe(A)+"_OnRoad";}else{if(this.$0.$==4){C="Order_"+a.toSafe(A)+"_Attack";}else{if(this.$0.$==5){C="Order_"+a.toSafe(A)+"_GreenFlare";}else{if(this.$0.$==6){C="Order_"+a.toSafe(A)+"_RedFlare";}else{if(this.$0.$==7){if(this.$1.$==0){E=this.$0.$0;D=$.New(d,{$:0,$0:$.New(e,{$:7,$0:E}),$1:{$:1,$0:{Speed:$.New(f,{$:1}),FireControl:$.New(g,{$:1})}}}).ToServerInput(A,B);}else{F=this.$0.$0;G=this.$1.$0;H=G.FireControl;I=H.$==1?"R":H.$==2?"H":"F";J=G.Speed;K=J.$==1?"N":J.$==2?"F":"S";L=B(F);D=a.toSafe(I)+a.toSafe(K)+"_"+a.toSafe(A)+"_"+a.toSafe(L);}C=D;}else{C="Order_"+a.toSafe(A)+"_Stop";}}}}}}}return C;}}),ShowPlayers:function(M){var N;N=h.toList(h.delay(function(){var P,Q,R;Q=i.ofArray([l.TextNode("Name")]);R=i.ofArray([l.TextNode("Ping")]);P=i.ofArray([l.Element("td",[],Q),l.Element("td",[],R)]);return h.append([l.Element("tr",[],P)],h.delay(function(){return h.map(function(T){var U,V,W;V=i.ofArray([l.TextNode(a.toSafe(T.Name))]);W=i.ofArray([l.TextNode(m.PadLeft($$.String(T.Ping),3))]);U=i.ofArray([l.Element("td",[],V),l.Element("td",[],W)]);return l.Element("tr",[],U);},M);}));}));return l.Element("table",[],N);},ShowResult:function(X){var Y,_2,_3;Y=function(Z){var _0,_1;_0=Z[0];_1=Z[1];return"Key: "+a.toSafe(_0)+" Value: "+a.toSafe(_1);};_2=i.map(Y,X);_3=i.map(function(_4){return l.TextNode(_4);},_2);return l.Element("div",[],_3);},Speed:$.Class({},{Show:function(_5){return _5.$==1?"normal speed":_5.$==2?"maximum speed":"slow speed";}}),TakeOrders:function(_6,_7,_8){var _9,_,ba,dF,dG;_9={User:{$:0},Coalition:{$:0},Available:$.New(n,{$:0}),Platoons:$.New(n,{$:0}),LoginMessage:{$:0},GrabMessage:{$:0},OrderMessage:{$:0}};_=o.Create(_9);ba=function(bb){var bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bD,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bV,bW,b$,cc,cd,ci,cj,ck,cm,co,cq,cr,cs,ct,cu,cv,cw,cx,cy,cz,cN,dm,dt,du,dv,dw,dx,dE;bc=bb.User;if(bc.$==1){bf=bc.$0.$0;bg="Command panel for "+a.toSafe(bf);be=l.TextNode(bg);}else{bh=o.Create("AAA");bi=o.Create("1234");bl=$.New(n,{$:0});bD=function(){return r.Send("Commander:3",[]);};bk=i.ofArray([l.TextNode("Your coalition code (3 letters) and your pin (4 digits):"),l.Input($.New(n,{$:0}),bh),l.Input($.New(n,{$:0}),bi),l.TextNode(" "),l.Button("Log in",bl,function(){var bn;bn=p.Delay(function(){var bp;bp=r.Async("Commander:2",[s.Get(bi),s.Get(bh).toUpperCase()]);return p.Bind(bp,function(bq){var br,bs,bt,bu,bv,bw,bx,by,bz,bA;if(bq.$==0){bs=[{$:0},{$:0},{$:1,$0:"Incorrect pin code"}];}else{bt=bq.$0[0].$0;bu=bq.$0[0];bv=bq.$0[1];bw=bv.AsString();bs=[{$:1,$0:bu},{$:1,$0:bv},{$:1,$0:"Welcome "+a.toSafe(bt)+" in coalition "+a.toSafe(bw)}];}br=bs;bx=br[0];by=br[2];bz=br[1];bA=bz.$==0?$.New(n,{$:0}):bz.$0.$==0?_7:_8;return p.Bind(r.Async("Commander:4",[bA]),function(bB){var bC;bC={User:bx,Coalition:bz,Available:bB,Platoons:bb.Platoons,LoginMessage:by,GrabMessage:bb.GrabMessage,OrderMessage:bb.OrderMessage};s.Set(_,bC);return p.Return(null);});});});return p.Start(bn,{$:0});}),l.TextNode(" "),l.Button("Request PIN",$.New(n,{$:0}),bD)]);bF=bb.LoginMessage;if(bF.$==1){bH=bF.$0;bG=bH;}else{bG="";}bj=i.ofArray([l.Element("div",[],bk),l.TextNode(bG)]);be=l.Element("div",[],bj);}bd=be;bI=[bb.User,bb.Coalition];if(bI[1].$==1){if(bI[0].$==1){bM=bI[1].$0;bN=bI[0].$0;bO=bb.Available;if(bO.$==1){bQ=bO.$0;bR=o.Create(bQ);bT=bb.Available;bV=$.New(n,{$:0});bW=bR.get_View();bS=i.ofArray([l.Select($.New(n,{$:0}),function(bU){return bU.AsString();},bT,bR),l.ButtonView("Add",bV,bW,function(bX){var bY;bY=p.Delay(function(){var b0;b0=r.Async("Commander:5",[bN,bX]);return p.Bind(b0,function(b1){var b2,b3;b2=bM.$==0?_7:_8;b3=r.Async("Commander:4",[b2]);return p.Bind(b3,function(b4){var b5,b6,b7,b8,b9,b_;if(b1){b6=$.New(n,{$:1,$0:bX,$1:bb.Platoons});b7={$:1,$0:"Platoon grabbed: "+a.toSafe(bX.AsString())};b8={User:bb.User,Coalition:bb.Coalition,Available:b4,Platoons:b6,LoginMessage:bb.LoginMessage,GrabMessage:b7,OrderMessage:bb.OrderMessage};s.Set(_,b8);b5=p.Return(null);}else{b9={$:1,$0:"Could not grab control of "+a.toSafe(bX.AsString())};b_={User:bb.User,Coalition:bb.Coalition,Available:b4,Platoons:bb.Platoons,LoginMessage:bb.LoginMessage,GrabMessage:b9,OrderMessage:bb.OrderMessage};s.Set(_,b_);b5=p.Return(null);}return b5;});});});return p.Start(bY,{$:0});})]);bP=l.Element("div",[],bS);}else{bP=l.TextNode("All platoons assigned");}bL=bP;}else{bL=l.get_Empty();}bK=bL;}else{bK=l.get_Empty();}bJ=bK;b$=function(ca){return function(cb){return[cb,ca];};};cc=i.mapi(b$,_6);cd=function(ce){return function(cf){var cg,ch;cg=cf[0];ch=cf[1];return ce.Add(cg,ch);};};ci=u.New1([]);cj=h.fold(cd,ci,cc);ck=function(cl){return"WP"+$$.String(cj.get_Item(cl));};cm=function(cn){return cn==="North"?[0,{$:0}]:cn==="North-East"?[1,{$:0}]:cn==="East"?[2,{$:0}]:cn==="South-East"?[3,{$:0}]:cn==="South"?[4,{$:0}]:cn==="South-West"?[5,{$:0}]:cn==="West"?[6,{$:0}]:cn==="North-West"?[7,{$:0}]:[8,{$:1,$0:cn}];};co=function(cp){return $.New(e,{$:7,$0:cp});};cq=i.sortBy(cm,_6);cr=i.map(co,cq);cs=i.ofArray([$.New(e,{$:3}),$.New(e,{$:2}),$.New(e,{$:4})]);ct=i.ofArray([$.New(f,{$:0}),$.New(f,{$:2})]);cu=i.ofArray([$.New(g,{$:0}),$.New(g,{$:1})]);cv=bb.User;if(cv.$==0){cx=l.get_Empty();}else{cy=cv.$0;cz=function(cA){return function(cB){return p.Delay(function(){var cD;cD=r.Async("Commander:7",[cy,cA]);return p.Bind(cD,function(cE){var cF,cG;if(cE){cG=cB.ToServerInput(cA.AsString(),ck);cF=p.Delay(function(){r.Send("Commander:0",[cG]);return p.Return({$:1,$0:"Order sent to "+a.toSafe(cA.AsString())});});}else{cF=p.Delay(function(){var cI;cI=r.Async("Commander:8",[cy]);return p.Bind(cI,function(cJ){var cK;cK={User:bb.User,Coalition:bb.Coalition,Available:bb.Available,Platoons:cJ,LoginMessage:bb.LoginMessage,GrabMessage:bb.GrabMessage,OrderMessage:bb.OrderMessage};s.Set(_,cK);return p.Return({$:1,$0:"Failed to issue order, possibly because you no longer have control over "+a.toSafe(cA.AsString())});});});}return p.Bind(cF,function(cL){var cM;cM={User:bb.User,Coalition:bb.Coalition,Available:bb.Available,Platoons:bb.Platoons,LoginMessage:bb.LoginMessage,GrabMessage:bb.GrabMessage,OrderMessage:cL};s.Set(_,cM);return p.Return(null);});});});};};cN=function(cO){var cP,cQ,cR,cS,cT,cU,c5,da,de,di;cP=o.Create(i.head(cs));cQ=o.Create(i.head(cr));cR=o.Create(i.head(ct));cS=o.Create(i.head(cu));cU=$.New(n,{$:0});c5=function(){var c7,c8;c7=$.New(d,{$:0,$0:s.Get(cP),$1:{$:0}});c8=(cz(cO))(c7);return p.Start(c8,{$:0});};da=function(){var dc,dd;dc=$.New(d,{$:0,$0:s.Get(cQ),$1:{$:1,$0:{Speed:s.Get(cR),FireControl:s.Get(cS)}}});dd=(cz(cO))(dc);return p.Start(dd,{$:0});};de=function(){var dg,dh;dg=$.New(d,{$:0,$0:$.New(e,{$:0}),$1:{$:0}});dh=(cz(cO))(dg);return p.Start(dh,{$:0});};di=function(){var dk,dl;dk=$.New(d,{$:0,$0:$.New(e,{$:1}),$1:{$:0}});dl=(cz(cO))(dk);return p.Start(dl,{$:0});};cT=i.ofArray([l.Button("X",cU,function(){var cW;cW=p.Delay(function(){var cY;r.Send("Commander:6",[cy,cO]);cY=r.Async("Commander:8",[cy]);return p.Bind(cY,function(cZ){var c0,c1;c0=bb.Coalition;c1=c0.$==0?$.New(n,{$:0}):c0.$0.$==0?_7:_8;return p.Bind(r.Async("Commander:4",[c1]),function(c2){var c3;c3={User:bb.User,Coalition:bb.Coalition,Available:c2,Platoons:cZ,LoginMessage:bb.LoginMessage,GrabMessage:bb.GrabMessage,OrderMessage:bb.OrderMessage};s.Set(_,c3);return p.Return(null);});});});return p.Start(cW,{$:0});}),l.TextNode(" "),l.TextNode(cO.AsString()),l.TextNode(" "),l.Select($.New(n,{$:0}),function(c4){return e.Show(c4);},cs,cP),l.TextNode(" "),l.Button("Order",$.New(n,{$:0}),c5),l.TextNode(" - "),l.TextNode("Move towards..."),l.Select($.New(n,{$:0}),function(c9){return e.Show(c9);},cr,cQ),l.TextNode(" at "),l.Select($.New(n,{$:0}),function(c_){return f.Show(c_);},ct,cR),l.TextNode(", "),l.Select($.New(n,{$:0}),function(c$){return g.Show(c$);},cu,cS),l.Button("Move",$.New(n,{$:0}),da),l.TextNode(" - "),l.Button("Stop",$.New(n,{$:0}),de),l.TextNode(" "),l.Button("Continue",$.New(n,{$:0}),di)]);return l.Element("div",[],cT);};dm=h.toList(h.delay(function(){return h.append(h.map(function(_do){return cN(_do);},bb.Platoons),h.delay(function(){var dq,dr,ds;dq=bb.OrderMessage;if(dq.$==0){dr=h.empty();}else{ds=dq.$0;dr=[l.TextNode(ds)];}return dr;}));}));cx=l.Element("div",[],dm);}cw=cx;dt=bb.User;if(dt.$==1){dw=dt.$0;dx=$.New(n,{$:0});dv=l.Button("Log out",dx,function(){var dz,dA,dB,dC,dD;r.Send("Commander:9",[dw]);dz={$:0};dA=$.New(n,{$:0});dB={$:0};dC={$:0};dD={User:dz,Coalition:dB,Available:bb.Available,Platoons:dA,LoginMessage:dC,GrabMessage:bb.GrabMessage,OrderMessage:bb.OrderMessage};return s.Set(_,dD);});}else{dv=l.get_Empty();}du=dv;dE=i.ofArray([bd,bJ,cw,du]);return l.Element("div",[],dE);};dF=_.get_View();dG=v.Map(ba,dF);return l.EmbedView(dG);}}},Users:{Coalition:$.Class({AsString:function(){return this.$==1?"Allies":"Axis";}},{IdOf:function(dH){return dH.$==1?1:2;}}),Unit:$.Class({AsString:function(){var dI;dI=this.$0;return dI;}}),User:$.Class({AsString:function(){var dJ;dJ=this.$0;return dJ;}})}});$.OnInit(function(){a=$.Safe($$.WebSharper.PrintfHelpers);b=$.Safe($$.Commander);c=$.Safe(b.WebCommander);d=$.Safe(c.OrderAndPolicy);e=$.Safe(c.Order);f=$.Safe(c.Speed);g=$.Safe(c.FireControl);h=$.Safe($$.WebSharper.Seq);i=$.Safe($$.WebSharper.List);j=$.Safe($$.WebSharper.UI);k=$.Safe(j.Next);l=$.Safe(k.Doc);m=$.Safe($$.WebSharper.Strings);n=$.Safe(i.T);o=$.Safe(k.Var);p=$.Safe($$.WebSharper.Concurrency);q=$.Safe($$.WebSharper.Remoting);r=$.Safe(q.AjaxRemotingProvider);s=$.Safe(k.Var1);t=$.Safe($$.WebSharper.Collections);u=$.Safe(t.FSharpMap);return v=$.Safe(k.View);});$.OnLoad(function(){return;});}());
