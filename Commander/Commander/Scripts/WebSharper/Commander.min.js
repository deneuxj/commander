(function(){var $$=this,$=this.IntelliFactory.Runtime,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;$.Define($$,{Commander:{WebCommander:{FireControl:$.Class({},{Show:function(w){return w.$==1?"return fire only":w.$==2?"hold fire":"free fire";}}),Order:$.Class({},{Show:function(x){var y,z;if(x.$==1){y="Continue";}else{if(x.$==2){y="Form off-road column";}else{if(x.$==3){y="Form on-road column";}else{if(x.$==4){y="Attack formation";}else{if(x.$==5){y="Fire a green flare";}else{if(x.$==6){y="Fire a red flare";}else{if(x.$==7){z=x.$0;y=z;}else{y="Stop";}}}}}}}return y;}}),OrderAndPolicy:$.Class({Description:function(A){var B,C,D,E,F,G,H,I,J;if(this.$0.$==1){B=a.toSafe(A)+": Continue";}else{if(this.$0.$==2){B=a.toSafe(A)+": Column";}else{if(this.$0.$==3){B=a.toSafe(A)+": On road";}else{if(this.$0.$==4){B=a.toSafe(A)+": Attack formation";}else{if(this.$0.$==5){B=a.toSafe(A)+": Fire green flare";}else{if(this.$0.$==6){B=a.toSafe(A)+": Fire red flare";}else{if(this.$0.$==7){if(this.$1.$==0){D=this.$0.$0;C=$.New(d,{$:0,$0:$.New(e,{$:7,$0:D}),$1:{$:1,$0:{Speed:$.New(f,{$:1}),FireControl:$.New(g,{$:1})}}}).Description(A);}else{E=this.$0.$0;F=this.$1.$0;G=F.FireControl;H=G.$==1?"return fire":G.$==2?"hold fire":"free fire";I=F.Speed;J=I.$==1?"normal":I.$==2?"fast":"slow";C=a.toSafe(A)+": Move to "+a.toSafe(E)+" at "+a.toSafe(J)+" speed, "+a.toSafe(H);}B=C;}else{B=a.toSafe(A)+": Stop";}}}}}}}return B;},ToServerInput:function(K,L){var M,N,O,P,Q,R,S,T,U,V;if(this.$0.$==1){M="Order_"+a.toSafe(K)+"_Continue";}else{if(this.$0.$==2){M="Order_"+a.toSafe(K)+"_Column";}else{if(this.$0.$==3){M="Order_"+a.toSafe(K)+"_OnRoad";}else{if(this.$0.$==4){M="Order_"+a.toSafe(K)+"_Attack";}else{if(this.$0.$==5){M="Order_"+a.toSafe(K)+"_GreenFlare";}else{if(this.$0.$==6){M="Order_"+a.toSafe(K)+"_RedFlare";}else{if(this.$0.$==7){if(this.$1.$==0){O=this.$0.$0;N=$.New(d,{$:0,$0:$.New(e,{$:7,$0:O}),$1:{$:1,$0:{Speed:$.New(f,{$:1}),FireControl:$.New(g,{$:1})}}}).ToServerInput(K,L);}else{P=this.$0.$0;Q=this.$1.$0;R=Q.FireControl;S=R.$==1?"R":R.$==2?"H":"F";T=Q.Speed;U=T.$==1?"N":T.$==2?"F":"S";V=L(P);N=a.toSafe(S)+a.toSafe(U)+"_"+a.toSafe(K)+"_"+a.toSafe(V);}M=N;}else{M="Order_"+a.toSafe(K)+"_Stop";}}}}}}}return M;}}),ShowPlayers:function(W){var X;X=h.toList(h.delay(function(){var Z,_0,_1;_0=i.ofArray([l.TextNode("Name")]);_1=i.ofArray([l.TextNode("Ping")]);Z=i.ofArray([l.Element("td",[],_0),l.Element("td",[],_1)]);return h.append([l.Element("tr",[],Z)],h.delay(function(){return h.map(function(_3){var _4,_5,_6;_5=i.ofArray([l.TextNode(a.toSafe(_3.Name))]);_6=i.ofArray([l.TextNode(m.PadLeft($$.String(_3.Ping),3))]);_4=i.ofArray([l.Element("td",[],_5),l.Element("td",[],_6)]);return l.Element("tr",[],_4);},W);}));}));return l.Element("table",[],X);},ShowResult:function(_7){var _8,bb,bc;_8=function(_9){var _,ba;_=_9[0];ba=_9[1];return"Key: "+a.toSafe(_)+" Value: "+a.toSafe(ba);};bb=i.map(_8,_7);bc=i.map(function(bd){return l.TextNode(bd);},bb);return l.Element("div",[],bc);},Speed:$.Class({},{Show:function(bd){return bd.$==1?"normal speed":bd.$==2?"maximum speed":"slow speed";}}),TakeOrders:function(be,bf,bg){var bh,bi,bj,dI,dJ;bh={User:{$:0},Coalition:{$:0},Available:$.New(n,{$:0}),Platoons:$.New(n,{$:0}),LoginMessage:{$:0},GrabMessage:{$:0}};bi=o.Create(bh);bj=function(bk){var bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bM,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b4,b5,ci,cl,cm,cr,cs,ct,cv,cx,cz,cA,cB,cC,cD,cE,cF,cG,cH,cI,cU,dt,dw,dx,dy,dz,dA,dH;bl=bk.User;if(bl.$==1){bo=bl.$0.$0;bp="Command panel for "+a.toSafe(bo);bn=l.TextNode(bp);}else{bq=o.Create("AAA");br=o.Create("1234");bu=$.New(n,{$:0});bM=function(){return r.Send("Commander:3",[true]);};bt=i.ofArray([l.TextNode("Your coalition code (3 letters) and your pin (4 digits):"),l.Input($.New(n,{$:0}),bq),l.Input($.New(n,{$:0}),br),l.TextNode(" "),l.Button("Log in",bu,function(){var bw;bw=p.Delay(function(){var by;by=r.Async("Commander:2",[s.Get(br),s.Get(bq).toUpperCase()]);return p.Bind(by,function(bz){var bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ;if(bz.$==0){bB=[{$:0},{$:0},{$:1,$0:"Incorrect pin code"}];}else{bC=bz.$0[0].$0;bD=bz.$0[0];bE=bz.$0[1];bF=bE.AsString();bB=[{$:1,$0:bD},{$:1,$0:bE},{$:1,$0:"Welcome "+a.toSafe(bC)+" in coalition "+a.toSafe(bF)}];}bA=bB;bG=bA[0];bH=bA[2];bI=bA[1];bJ=bI.$==0?$.New(n,{$:0}):bI.$0.$==0?bf:bg;return p.Bind(r.Async("Commander:4",[bJ]),function(bK){var bL;bL={User:bG,Coalition:bI,Available:bK,Platoons:bk.Platoons,LoginMessage:bH,GrabMessage:bk.GrabMessage};s.Set(bi,bL);return p.Return(null);});});});return p.Start(bw,{$:0});}),l.TextNode(" "),l.Button("Request PIN",$.New(n,{$:0}),bM)]);bO=bk.LoginMessage;if(bO.$==1){bQ=bO.$0;bP=bQ;}else{bP="";}bs=i.ofArray([l.Element("div",[],bt),l.TextNode(bP)]);bn=l.Element("div",[],bs);}bm=bn;bR=[bk.User,bk.Coalition];if(bR[1].$==1){if(bR[0].$==1){bV=bR[1].$0;bW=bR[0].$0;bX=bk.Available;if(bX.$==1){bZ=bX.$0;b0=o.Create(bZ);b2=bk.Available;b4=$.New(n,{$:0});b5=b0.get_View();b1=i.ofArray([l.Select($.New(n,{$:0}),function(b3){return b3.AsString();},b2,b0),l.ButtonView("Add",b4,b5,function(b6){var b7;b7=p.Delay(function(){var b9;b9=r.Async("Commander:5",[bW,b6]);return p.Bind(b9,function(b_){var b$,ca;b$=bV.$==0?bf:bg;ca=r.Async("Commander:4",[b$]);return p.Bind(ca,function(cb){var cc,cd,ce,cf,cg,ch;if(b_){cd=$.New(n,{$:1,$0:b6,$1:bk.Platoons});ce={$:1,$0:"Platoon grabbed: "+a.toSafe(b6.AsString())};cf={User:bk.User,Coalition:bk.Coalition,Available:cb,Platoons:cd,LoginMessage:bk.LoginMessage,GrabMessage:ce};s.Set(bi,cf);cc=p.Return(null);}else{cg={$:1,$0:"Could not grab control of "+a.toSafe(b6.AsString())};ch={User:bk.User,Coalition:bk.Coalition,Available:cb,Platoons:bk.Platoons,LoginMessage:bk.LoginMessage,GrabMessage:cg};s.Set(bi,ch);cc=p.Return(null);}return cc;});});});return p.Start(b7,{$:0});})]);bY=l.Element("div",[],b1);}else{bY=l.TextNode("All platoons assigned");}bU=bY;}else{bU=l.get_Empty();}bT=bU;}else{bT=l.get_Empty();}bS=bT;ci=function(cj){return function(ck){return[ck,cj];};};cl=i.mapi(ci,be);cm=function(cn){return function(co){var cp,cq;cp=co[0];cq=co[1];return cn.Add(cp,cq);};};cr=u.New1([]);cs=h.fold(cm,cr,cl);ct=function(cu){return"WP"+$$.String(cs.get_Item(cu));};cv=function(cw){return cw==="North"?[0,{$:0}]:cw==="North-East"?[1,{$:0}]:cw==="East"?[2,{$:0}]:cw==="South-East"?[3,{$:0}]:cw==="South"?[4,{$:0}]:cw==="South-West"?[5,{$:0}]:cw==="West"?[6,{$:0}]:cw==="North-West"?[7,{$:0}]:[8,{$:1,$0:cw}];};cx=function(cy){return $.New(e,{$:7,$0:cy});};cz=i.sortBy(cv,be);cA=i.map(cx,cz);cB=i.ofArray([$.New(e,{$:3}),$.New(e,{$:2}),$.New(e,{$:4})]);cC=i.ofArray([$.New(f,{$:0}),$.New(f,{$:2})]);cD=i.ofArray([$.New(g,{$:0}),$.New(g,{$:1})]);cE=bk.User;if(cE.$==0){cG=l.get_Empty();}else{cH=cE.$0;cI=function(cJ){return function(cK){return p.Delay(function(){var cM;cM=r.Async("Commander:7",[cH,cJ]);return p.Bind(cM,function(cN){var cO,cP;if(cN){cP=cK.ToServerInput(cJ.AsString(),ct);r.Send("Commander:0",[cP,cH,cK.Description(cJ.AsString())]);cO=p.Delay(function(){return p.Return(null);});}else{cO=p.Delay(function(){return p.Bind(r.Async("Commander:8",[cH]),function(cS){var cT;cT={User:bk.User,Coalition:bk.Coalition,Available:bk.Available,Platoons:cS,LoginMessage:bk.LoginMessage,GrabMessage:bk.GrabMessage};s.Set(bi,cT);return p.Return(null);});});}return cO;});});};};cU=function(cV){var cW,cX,cY,cZ,c0,c1,da,dh,dl,dp;cW=o.Create(i.head(cB));cX=o.Create(i.head(cA));cY=o.Create(i.head(cC));cZ=o.Create(i.head(cD));c1=$.New(n,{$:0});da=function(){var dc,dd;dc=$.New(d,{$:0,$0:s.Get(cW),$1:{$:0}});dd=(cI(cV))(dc);return p.Start(dd,{$:0});};dh=function(){var dj,dk;dj=$.New(d,{$:0,$0:s.Get(cX),$1:{$:1,$0:{Speed:s.Get(cY),FireControl:s.Get(cZ)}}});dk=(cI(cV))(dj);return p.Start(dk,{$:0});};dl=function(){var dn,_do;dn=$.New(d,{$:0,$0:$.New(e,{$:0}),$1:{$:0}});_do=(cI(cV))(dn);return p.Start(_do,{$:0});};dp=function(){var dr,ds;dr=$.New(d,{$:0,$0:$.New(e,{$:1}),$1:{$:0}});ds=(cI(cV))(dr);return p.Start(ds,{$:0});};c0=i.ofArray([l.Button("X",c1,function(){var c3;c3=p.Delay(function(){var c5;r.Send("Commander:6",[cH,cV]);c5=r.Async("Commander:8",[cH]);return p.Bind(c5,function(c6){var c7,c8;c7=bk.Coalition;c8=c7.$==0?$.New(n,{$:0}):c7.$0.$==0?bf:bg;return p.Bind(r.Async("Commander:4",[c8]),function(c9){var c_;c_={User:bk.User,Coalition:bk.Coalition,Available:c9,Platoons:c6,LoginMessage:bk.LoginMessage,GrabMessage:bk.GrabMessage};s.Set(bi,c_);return p.Return(null);});});});return p.Start(c3,{$:0});}),l.TextNode(" "),l.TextNode(cV.AsString()),l.TextNode(" "),l.Select($.New(n,{$:0}),function(c$){return e.Show(c$);},cB,cW),l.TextNode(" "),l.Button("Order",$.New(n,{$:0}),da),l.TextNode(" - "),l.TextNode("Move towards..."),l.Select($.New(n,{$:0}),function(de){return e.Show(de);},cA,cX),l.TextNode(" at "),l.Select($.New(n,{$:0}),function(df){return f.Show(df);},cC,cY),l.TextNode(", "),l.Select($.New(n,{$:0}),function(dg){return g.Show(dg);},cD,cZ),l.Button("Move",$.New(n,{$:0}),dh),l.TextNode(" - "),l.Button("Stop",$.New(n,{$:0}),dl),l.TextNode(" "),l.Button("Continue",$.New(n,{$:0}),dp)]);return l.Element("div",[],c0);};dt=h.toList(h.delay(function(){return h.map(function(dv){return cU(dv);},bk.Platoons);}));cG=l.Element("div",[],dt);}cF=cG;dw=bk.User;if(dw.$==1){dz=dw.$0;dA=$.New(n,{$:0});dy=l.Button("Log out",dA,function(){var dC,dD,dE,dF,dG;r.Send("Commander:9",[dz]);dC={$:0};dD=$.New(n,{$:0});dE={$:0};dF={$:0};dG={User:dC,Coalition:dE,Available:bk.Available,Platoons:dD,LoginMessage:dF,GrabMessage:bk.GrabMessage};return s.Set(bi,dG);});}else{dy=l.get_Empty();}dx=dy;dH=i.ofArray([bm,bS,cF,dx]);return l.Element("div",[],dH);};dI=bi.get_View();dJ=v.Map(bj,dI);return l.EmbedView(dJ);}}},Users:{Coalition:$.Class({AsString:function(){return this.$==1?"Allies":"Axis";}},{IdOf:function(dK){return dK.$==1?1:2;}}),Unit:$.Class({AsString:function(){var dL;dL=this.$0;return dL;}}),User:$.Class({AsString:function(){var dM;dM=this.$0;return dM;}})}});$.OnInit(function(){a=$.Safe($$.WebSharper.PrintfHelpers);b=$.Safe($$.Commander);c=$.Safe(b.WebCommander);d=$.Safe(c.OrderAndPolicy);e=$.Safe(c.Order);f=$.Safe(c.Speed);g=$.Safe(c.FireControl);h=$.Safe($$.WebSharper.Seq);i=$.Safe($$.WebSharper.List);j=$.Safe($$.WebSharper.UI);k=$.Safe(j.Next);l=$.Safe(k.Doc);m=$.Safe($$.WebSharper.Strings);n=$.Safe(i.T);o=$.Safe(k.Var);p=$.Safe($$.WebSharper.Concurrency);q=$.Safe($$.WebSharper.Remoting);r=$.Safe(q.AjaxRemotingProvider);s=$.Safe(k.Var1);t=$.Safe($$.WebSharper.Collections);u=$.Safe(t.FSharpMap);return v=$.Safe(k.View);});$.OnLoad(function(){return;});}());
